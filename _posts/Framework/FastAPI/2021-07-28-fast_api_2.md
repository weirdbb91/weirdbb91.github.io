---
header:
  teaser            : # μΈλ„¤μΌ μ΄λ―Έμ§€ /assets/images/face_army.jpg
title               : FastAPI 2 # μ λ©
excerpt             : Python FastAPI Framework 2 # μΈλ„¤μΌ ν•μ¤„ μ”μ•½
last_modified_at    : 2021-07-28 # λ§μ§€λ§‰ μμ •μΌ
categories          : Framework FastAPI
tags                : FastAPI Python
toc                 : # λ©μ°¨ μ‚¬μ©μ—¬λ¶€
toc_label           : # λ©μ°¨ μ λ©
# {: .notice--info}
---

---
## μ¶μ² : [FastAPI](https://fastapi.tiangolo.com/)

π« μ•„λ λ‚΄μ©μ€ μ£Όκ΄€μ μΈ μƒκ°μ΄λ―€λ΅ μ‚¬μ‹¤κ³Ό λ‹¤λ¥Ό μ μμµλ‹λ‹¤.

---
---

## Path Parameters
```py
from fastapi import FastAPI

app = FastAPI()


@app.get("/items/{item_id}")
async def read_item(item_id):
    return {"item_id": item_id}
```
- κ²½λ΅μ— νλΌλ―Έν„°/λ³€μλ¥Ό νμ΄μ¬ fμ¤νΈλ§ λ¬Έλ²•κ³Ό λ™μΌν•κ² μ„ μ–Έ κ°€λ¥
- ν¨μ¤ νλΌλ―Έν„° item_idμ κ°’μ΄ read_item ν•¨μμ μΈμ item_idλ΅ μ „λ‹¬λ¨
- 127.0.0.1:8000/items/foo μ”μ²­μ‹ λ°ν™κ°’μ€
  ```py
  {"item_id":"foo"}
  ```

### Path parameters with types
```py
@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```
- νμ΄μ¬ κΈ°λ³Έ νƒ€μ…λ“¤μ„ μ‚¬μ©ν•΄ ν•¨μ λ‚΄ ν¨μ¤ νλΌλ―Έν„°μ νƒ€μ…μ„ μ§€μ • κ°€λ¥
- νƒ€μ…μ—λ¬ μλ™ λ°ν™

### Data conversion
- μ„ μ½”λ“μ²λΌ νƒ€μ… μ§€μ •μ‹, λ¬Έμμ—΄λ΅ μ…λ ¥ λ°›μ•„λ„ μλ™ ν•λ³€ν™ = "3" -> 3

### Data validation
- νƒ€μ… μ§€μ • ν›„, μλ™ ν•λ³€ν™μ΄ λ¶κ°€ν• κ°’μ„ μ…λ ¥μ‹ μ•„λμ HTTP error λ°ν™
  ```py
    {
        "detail": [
            {
                "loc": [
                    "path",
                    "item_id"
                ],
                "msg": "value is not a valid integer",
                "type": "type_error.integer"
            }
        ]
    }
  ```
- int νƒ€μ… μ§€μ • ν›„, μ†μ(float) νƒ€μ… μ…λ ¥μ‹μ—λ„ μ„μ™€ μ μ‚¬ν• μ—λ¬ λ°ν™

### Documentation
- Base URL λ’¤μ— "/docs"λ¥Ό μ¶”κ°€ν•λ©΄(127.0.0.1:8000/docs)  
  Swagger UIλ΅ κµ¬μ„±λ API λ¬Έμ„ μλ™ μ¶λ ¥
- "/docs" μ™Έμ λ€μ•μΌλ΅ "/redoc" λν• κ°€λ¥

### Pydantic
- λ¨λ“  λ°μ΄ν„° νƒ€μ… κ²€μ¦μ€ Pydanticμ„ ν†µν•΄ μ§„ν–‰λλ―€λ΅  
  Pydanticμ λ¨λ“  μ¥μ μ„ μ΄μ© κ°€λ¥

### Order matters
```py
from fastapi import FastAPI

app = FastAPI()


@app.get("/users/me")
async def read_user_me():
    return {"user_id": "the current user"}


@app.get("/users/{user_id}")
async def read_user(user_id: str):
    return {"user_id": user_id}
```
- μ„μ™€ κ°™μ΄ κµ¬μ²΄μ μΈ κ²½λ΅λ¥Ό λ¨Όμ € μ„ μ–Έν•΄μ¤μ•Ό μμ„μ λ¬Έμ κ°€ λ°μƒν•μ§€ μ•μ
- λ§μ•½ read_user ν•¨μλ¥Ό λ¨Όμ € μ„ μ–Έν•κ² λλ©΄,  
  "/users/me" νΈμ¶μ‹, {"user_id": "me"}λ¥Ό λ°ν™ λ°›μ„ μλ„ μμ

### Predefined values
- λ§μ•½ κ²½λ΅μ— ν¨μ¤ νλΌλ―Έν„°λ¥Ό μ‚¬μ©μ¤‘μ΄κ³ ,  
  ν•΄λ‹Ή ν¨μ¤ νλΌλ―Έν„°λ΅ λ„κ²¨λ°›μ„ κ°’λ“¤μ΄ μ ν•μ μ΄μ–΄μ•Ό ν•λ‹¤λ©΄,  
  νμ΄μ¬μ Enumμ„ μ‚¬μ©ν•  μ μλ‹¤

#### Create an Enum class
- μ•„λμ™€ κ°™μ΄ Enumμ„ μ„ν¬νΈν•κ³  str, Enumμ„ μƒμ†λ°›λ” ν΄λμ¤λ¥Ό μ •μν•λ‹¤  

```py
from enum import Enum

from fastapi import FastAPI


class ModelName(str, Enum):
    alexnet = "alexnet"
    resnet = "resnet"
    lenet = "lenet"


app = FastAPI()


@app.get("/models/{model_name}")
async def get_model(model_name: ModelName):
    if model_name == ModelName.alexnet:
        return {"model_name": model_name, "message": "Deep Learning FTW!"}

    if model_name.value == "lenet":
        return {"model_name": model_name, "message": "LeCNN all the images"}

    return {"model_name": model_name, "message": "Have some residuals"}
```
- Enum μ‚¬μ©μ€ νμ΄μ¬ 3.4 μ΄μƒλ¶€ν„° κ°€λ¥ν•λ‹¤

#### Declare a path parameter
- μ„ μ½”λ“μ²λΌ λ―Έλ¦¬ μ •μν• Enum νƒ€μ…μ„ ν¨μ¤ νλΌλ―Έν„° νƒ€μ…μΌλ΅ μ§€μ •μ΄ κ°€λ¥

#### Check the docs
- ν¨μ¤ νλΌλ―Έν„° νƒ€μ…μΌλ΅ Enum νƒ€μ…μ„ μ§€μ •ν•λ©΄, docs λ¬Έμ„μ—μ„λ„ λ°μμ΄ λλ‹¤

#### Working with Python enumerations
- κ·Έλ ‡κ² ν¨μ¤ νλΌλ―Έν„°λ΅ λ°›μ€ κ°’μ€ μ§€μ •λ Enumμ λ©¤λ²„κ°€ λλ‹¤
- νλΌλ―Έν„°λ΅ μ „λ‹¬ λ°›μ€ κ°’μ„ Enum λ©¤λ²„μ™€ λΉ„κµμ—°μ‚°μλ΅ λΉ„κµ κ°€λ¥
- Enum λ©¤λ²„μ μ‹¤μ  κ°’μ„ μ–»μΌλ ¤λ©΄ .value μ‚¬μ©
- Enum λ©¤λ²„ λ°ν™μ‹μ—λ” ν•΄λ‹Ή κ°’μΌλ΅ μλ™ λ³€ν™λμ–΄ λ°ν™
  ```py
  return ModelName.alexnet
  -> "alexnet"
  ```

### Path parameters containing paths
- ν¨μ¤ νλΌλ―Έν„°λ΅ κ²½λ΅λ¥Ό λ°›λ” κ²½μ° Starlette λ‚΄λ¶€ κΈ°λ¥μ„ μ΄μ©ν•λ‹¤

#### Path convertor
```py
@app.get("/files/{file_path:path}")
async def read_file(file_path: str):
```
- μ„μ™€ κ°™μ΄ :pathλ§ λ’¤μ— λ¶™μ—¬μ£Όλ©΄ λλ‹¤
- κ²½λ΅κ°’ μ•μ— "/"κ°€ λ¶™μ„ κ²½μ°(/myfile.txt)  
  μµμΆ… κ²½λ΅κ°€ "files//myfile.txt"κ°€ λμ–΄ "//" λ°μƒ κ°€λ¥

---
---

## Query Parameters
```py
from fastapi import FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]


@app.get("/items/")
async def read_item(skip: int = 0, limit: int = 10):
    return fake_items_db[skip : skip + limit]
```

- ν•¨μ νλΌλ―Έν„° μ¤‘ ν¨μ¤ νλΌλ―Έν„°λ΅ κΈ°μ¬λμ§€ μ•μ€ νλΌλ―Έν„°λ“¤μ€  
  μλ™μΌλ΅ μΏΌλ¦¬ νλΌλ―Έν„°λ΅ μ§€μ •λλ‹¤
- μΏΌλ¦¬λ” ν‚¤-λ°Έλ¥ νμ–΄λ΅ κµ¬μ„±λλ©° URL λ’¤μ— "?"μΌλ΅ μ‹μ‘ν•΄ "&"μΌλ΅ κµ¬λ¶„λλ‹¤
  ```py
  μμ  -> http://127.0.0.1:8000/items/?skip=0&limit=10
  ```
- URLμ λ¶€λ¶„μΈ μ΄μƒ μΏΌλ¦¬ νλΌλ―Έν„°μ νƒ€μ…λ“¤μ€ Stringμ΄μ§€λ§,  
  νƒ€μ…μ„ λ…μ‹ν•΄λ’€λ‹¤λ©΄, μ§€μ •λ νƒ€μ…μΌλ΅ μλ™ ν•λ³€ν™μ΄ λλ‹¤

### Defaults
- κΈ°λ³Έκ°’μ„ μ§€μ •ν–λ‹¤λ©΄ ν•΄λ‹Ή νλΌλ―Έν„°λ¥Ό μƒλµν•΄λ„ κΈ°λ³Έκ°’μΌλ΅ κ°’μ΄ μ „λ‹¬λλ‹¤

### Optional parameters
- μ•„λμ™€ κ°™μ΄ Optionalκ³Ό κΈ°λ³Έκ°’μΌλ΅ Noneμ„ μ„¤μ •ν•λ©΄  
  λΉ„ν•„μ νλΌλ―Έν„°λ¥Ό μ§€μ •ν•  μ μλ‹¤
    ```py
    @app.get("/items/{item_id}")
    async def read_item(item_id: str, q: Optional[str] = None):
        if q:
            return {"item_id": item_id, "q": q}
        return {"item_id": item_id}
    ```

### Query parameter type conversion
- bool νƒ€μ…λ„ μΏΌλ¦¬ νλΌλ―Έν„°λ΅ λ°›μ„ μ μμΌλ©°,  
  falsyν• κ°’μ΄ μ•„λ‹λΌλ©΄ Trueκ°’μ boolλ΅ μλ™ λ³€ν™ν•΄μ¤€λ‹¤

### Multiple path and query parameters
- λ‹¤μμ ν¨μ¤ νλΌλ―Έν„° λν• λ™μ‹μ— μ‚¬μ©κ°€λ¥ν•λ©°,  
  μ΄ λ•μ—λ” λ”±ν νΉμ •ν• μμ„λ€λ΅ μ„ μ–Έν•  ν•„μ”κ°€ μ—†λ‹¤

### Required query parameters
- μΏΌλ¦¬ νλΌλ―Έν„°μ κΈ°λ³Έκ°’μ„ μ§€μ •ν•μ§€ μ•μΌλ©΄ ν•„μ νλΌλ―Έν„°κ°€ λλ‹¤
```py
@app.get("/items/{item_id}")
async def read_user_item(item_id: str, needy: str):
    item = {"item_id": item_id, "needy": needy}
    return item
```
- λ§μ•½ ν•„μ νλΌλ―Έν„°μ κ°’μ„ μƒλµν•λ©΄ μ•„λμ™€ κ°™μ€ errorκ°€ λ°μƒν•λ‹¤  
  ```py
    {
        "detail": [
            {
                "loc": [
                    "query",
                    "needy"
                ],
                "msg": "field required",
                "type": "value_error.missing"
            }
        ]
    }
  ```
- ν¨μ¤ νλΌλ―Έν„°μ—μ„ λ‹¤λ¤λ Enum λν• κ°™μ€ λ°©μ‹μΌλ΅ μ‚¬μ©μ΄ κ°€λ¥ν•λ‹¤

---
---


## Request Body
## Query Parameters and String Validations
## Path Parameters and Numeric Validations